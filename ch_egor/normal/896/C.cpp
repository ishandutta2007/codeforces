// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936
// https://mobile.twitter.com/Jinotega3000/status/855041793620135936

#include <stdio.h>
#include <iostream>
#include <stdlib.h>
#include <string>
#include <string.h>
#include <vector>
#include <stack>
#include <queue>
#include <deque>
#include <set>
#include <map>
#include <assert.h>
#include <algorithm>
#include <iomanip>
#include <time.h>
#include <math.h>
#include <bitset>

#pragma comment(linker, "/STACK:256000000")

using namespace std;

typedef long long int ll;
typedef long double ld;

const int INF = 1000 * 1000 * 1000 + 21;
const ll LLINF = (1ll << 60) + 5;
const int MOD = 1000 * 1000 * 1000 + 7;


ll n, m, seed, vm;
set<pair<pair<ll, ll>, ll>> gg;

ll pw(ll x, ll n, ll mod)
{
	ll ans = 1;
	x %= mod;
	while (n)
	{
		if (n & 1) ans = (ans * x) % mod;
		x = (x * x) % mod;
		n >>= 1;
	}

	return ans % mod;
}

void div(int x)
{
	auto it = gg.upper_bound({{x, LLINF}, LLINF});
	--it;
	
	auto mem = *it;
	
	if (x != mem.first.first)
	{
		gg.erase(it);
		gg.insert({{mem.first.first, x}, mem.second});
		gg.insert({{x, mem.first.second}, mem.second});
	}
}

void add_on(int l, int r, ll x)
{
	div(l);
	div(r);
	
	auto it = gg.upper_bound({{l, LLINF}, LLINF});
	--it;
	
	while (it != gg.end() && it->first.first < r)
	{
		pair<pair<ll, ll>, ll> *gg = (pair<pair<ll, ll>, ll>*)&(*it);
		gg->second += x;
		++it;	
	}
}

void set_on(int l, int r, ll x)
{
	div(l);
	div(r);
	
	auto it = gg.upper_bound({{l, LLINF}, LLINF});
	--it;

	while (it != gg.end() && it->first.first < r)
	{
		it = gg.erase(it);
	}

	gg.insert({{l, r}, x});
}

ll get_sort(int l, int r, int x)
{
	auto it = gg.upper_bound({{l, LLINF}, LLINF});
	if (it == gg.end() || it->first.first > l) --it;
	
	vector<pair<ll, ll>> now;

	while (it != gg.end() && it->first.first < r)
	{
		ll lg = max((ll)l, it->first.first);
		ll rr = min(it->first.second, (ll)r);
		now.push_back({it->second, rr - lg});
		++it;
	}
	
	sort(now.begin(), now.end());

	for (int i = 0; i < (int)now.size(); ++i)
	{
		if (now[i].second >= x) return now[i].first;
		x -= now[i].second;
	}

	return -1;
}

ll get_sum(int l, int r, ll x, ll y)
{
	auto it = gg.upper_bound({{l, LLINF}, LLINF});
	if (it == gg.end() || it->first.first > l) --it;
	
	ll ans = 0;
	while (it != gg.end() && it->first.first < r)
	{
		ll lg = max((ll)l, it->first.first);
		ll rr = min(it->first.second, (ll)r);
		ll now = pw(it->second, x, y);
		ans = (ans + (rr - lg) * now) % y;
		++it;
	}

	return ans;
}

ll rnd()
{
	ll ret = seed;
	seed = (seed * 7ll + 13ll) % MOD;
	return ret;
}

void solve()
{
	gg.clear();

	gg.insert({{0, n}, 0});

	for (int i = 0; i < n; ++i)
	{
		set_on(i, i + 1, rnd() % vm + 1);
	}

	ll op, l, r, x, y;
	for (int i = 0; i < m; ++i)
	{
		op = rnd() % 4 + 1;
		l = rnd() % n;
		r = rnd() % n;
		

		if (l > r) swap(l, r);

		if (op == 3)
			x = rnd() % (r - l + 1) + 1;
		else
			x = rnd() % vm + 1;
		
		if (op == 4)
			y = rnd() % vm + 1;

		if (op == 1)
		{
			add_on(l, r + 1, x);
		}
		else if (op == 2)
		{
			set_on(l, r + 1, x);
		}
		else if (op == 3)
		{
			printf("%lld\n", get_sort(l, r + 1, x));
		}
		else if (op == 4)
		{
			printf("%lld\n", get_sum(l, r + 1, x, y));
		}
	}
}

int main()
{
#ifdef CH_EGOR
	freopen("input.txt", "r", stdin);
	//freopen("output.txt", "w", stdout);
#else
	//freopen("", "r", stdin);
	//freopen("", "w", stdout);
#endif

	scanf("%lld%lld%lld%lld", &n, &m, &seed, &vm);
	
	solve();	
	
/*	for (int i = 0; i < 100000; ++i)
	{
		n = 100000;
		m = 100000;
		seed = rand() % MOD;
		vm = rand() % (int)1e9;
		double now = clock();
		solve();
		double gg = clock();
		fprintf(stderr, "%.10lf\n", (gg - now) / CLOCKS_PER_SEC);
		assert((gg - now) / CLOCKS_PER_SEC <= 1.5);
	}
*/

	return 0;
}